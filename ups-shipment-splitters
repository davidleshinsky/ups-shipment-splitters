import streamlit as st
import pandas as pd
from io import BytesIO
import zipfile

st.set_page_config(page_title="UPS Splitter", layout="wide")
st.title("ðŸ“¦ UPS Shipment File Splitter")

uploaded_file = st.file_uploader("Upload UPS Tracking File (CSV or Excel)", type=["csv", "xlsx"])

if uploaded_file:
    # Load data
    try:
        if uploaded_file.name.endswith(".csv"):
            df = pd.read_csv(uploaded_file)
        else:
            df = pd.read_excel(uploaded_file)
    except Exception as e:
        st.error(f"Error reading file: {e}")
        st.stop()

    # Extract main reference and clean date
    df["Main Reference"] = df["Reference Number(s)"].str.extract(r"^([A-Z]+\d+)", expand=False)
    df["Manifest Date"] = pd.to_datetime(df["Manifest Date"]).dt.strftime("%Y-%m-%d")
    df["Sheet Name"] = df["Main Reference"] + "_" + df["Manifest Date"]

    # Group and export
    output = BytesIO()
    with zipfile.ZipFile(output, "w") as zip_buffer:
        for name, group in df.groupby("Sheet Name"):
            buffer = BytesIO()
            group.to_excel(buffer, index=False)
            zip_buffer.writestr(f"{name}.xlsx", buffer.getvalue())
    
    st.success("Your files are ready!")
    st.download_button("Download ZIP", output.getvalue(), file_name="UPS_Shipments_Split.zip")
streamlit
pandas
openpyxl
